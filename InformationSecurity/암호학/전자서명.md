## 전자서명
### 전자서명
---
#### 기본 원리
* 서명과 검증
전자서명에 사용하는 검증키는 공개 키이고, 서명키는 서명자 본인만 알고 있어야 하는 비밀키이다. 메시지를 서명키로 암호화하는 과정을 서명 작성, 서명을 검증키로 복호화하고 받은 메시지와 비교하는 과정을 서명 검증이라고 한다. 검증키를 pk, 서명키를 sk, 서명 검증 알고리즘을 Ver, 서명 생성 알고리즘을 Sig라고 할때, 메시지 m에 대한 서명 s는 s = Sig sk(m)이고, 서명자의 검증키를 이용해 Ver pk(m, s)값을 계산하여 검증한다. 
* 해시 함수를 이용한 전자 서명
메시지의 크기가 N(modulus)보다 작아야 한다. 만약 N보다 크다면 나누어 서명해야한다. 이러한 불편함을 해소하기 위해 해시 함수를 같이 사용한다. 해시 함수를 이용한 전자 서명에서는 해시 함수로 메시지의 해시 값을 생성하고, 이 값에 대한 서명을 생성한다. 그래서 위의 식에 m이 h(m)으로 바뀌게 된다. 여기서 h는 임의의 암호학적 해시 함수를 의미한다.
#### RSA 전자 서명
* 서명 생성
서명키 d로 메시지 m에 대한 서명 s는 s = m^d(mod n)으로 생성한다.
* 서명 검증
서명 값 s와 메시지 값 m에 대한 검증을 검증키 (n, e)를 통해 !m = s^e(mod n)을 계산하고 !m과 m이 같은 값인지 확인한다. 같은 값이면 유효한 서명이고, 그렇지 않으면 유효하지 않다.
* RSA 전자 서명 공격
1. 공격자가 검증키 (n, e)를 알면, 유효한 메시지와 서명 쌍을 생성할 수 있다. m = s^e(mod n)
2. 공격자가 두 개의 유효한 메시지와 이에 대응되는 서명쌍 (m1, s1), (m2, s2)를 알고 있다면, 다른 유효한 평문과 서명쌍 (m1m2, s1s2)를 생성할 수 있다. 합동식의 성질에 따라 s1s2 = (m1m2)^d (mod n)으로 식이 세워지기 때문이다.
#### 해시를 이용한 RSA 전자 서명
해시를 이용하면 m이 h(m)으로 바뀌기 때문에 안전한 전자 서명을 할 수 있다. 이는 해시 함수의 역상 저항성때문이다.
#### ELGamal
* ELGamal 키 생성
큰 소수 p와 키를 만드는 생성원 g를 선택한다. 그 뒤, p-1보다 큰 정수 x를 선택한다. y = g^x (mod p)를 계산하여 (y, g, p)를 검증키로, x를 서명키로 사용한다.
* 서명 생성
p-1보다 작고, 서로소인 k를 정해서 s를 만든다.
1. γ = g^k (mod p)
2. δ = (m - xγ)k^-1 (mod p-1)
3. s = (γ, δ)
* 서명 검증
서명 s = (δ, γ), 메시지 m, 검증키 (y, g, p)가 있을 때, 서명 s에 대한 검증은 g^m (mod p)와 y^γ*γ^δ (mod p)의 비교로 이뤄진다. 이 둘이 같은 값이면 s는 유효한 서명이다. 
* ELGamal 전자 서명 공격
서명 생성 과정에서 매번 서명을 할 때마다 새로운 난수 k를 선택하여 사용하기 때문에 동일한 메시지에 대해서도 서명 값이 항상 변한다. 이러한 특성을 비결정적이라고 하며, RSA서명기법의 문제를 해결해준다. 하지만 난수 k를 매법 같은 값으로 고정하면 서명키 x가 노출될 수 있다. 공격 방법은 두개의 메시지 m1, m2에 대해서 같은 k를 사용한 서명 s1 = (γ1, δ1), s2 = (γ2, δ2)를 가지고 있다면, k = (m1 - m2)(δ1 - δ2)^-1 (mod p-1)로 구할 수 있고, x = (m1 - δ1k)γ1^-1 (mod p - 1)을 통해 서명키 x를 알 수 있다. 따라서 k값은 고정된 값이 아니라 적절한 난수값으로 정해야 한다.
#### DSA 전자 서명
큰 소수 p와 p-1의 약수이면서 소수인 q를 선택한다. 이후 p-1보다 작고 1보다 큰 정수 h를 선택하고 생성원 g = h^(p-1)/q (mod p)를 계산한다. 만약 g가 1이 되면, h를 다시 선택하여 1이 아닌 g를 구한다. 이후, 1 ~ q - 1 범위의 큰 정수 x를 임의로 선택한다. y = g^x (mod p)를 계산하여 (y, g, p, q)를 검증키로, x를 서명키로 사용한다. 마지막으로 안전한 해시함수 h를 선택한다.
* 서명 생성
1 ~ q-1 범위의 난수 k를 임의로 선택한 뒤, 서명 값 s = (γ, δ)를 계산한다. 
* 서명 검증
서명값 s와 메시지 m에 대한 검증을 검증키 (y, g, p, q)를 통해 수행한다. 최종적으로 γ = (g^k (mod p))(mod q) = (g^e1*y^e2 (mod p))(mod q)의 식을 얻을 수 있다. 따라서 !γ이 γ와 동일하다면 그 서명은 유효하다.