## Cookie
### Cookie란?
---
클라이언트의 IP 주소나 User-Agent는 매번 변경될 뿐만 아니라, HTTP 프로토콜의 **Connectionless**와 **Stateless** 특징때문에 웹 서버는 클라이언트를 기억할 수 없다. 그래서 HTTP의 상태를 유지하기 위해 나온 것이 **쿠키**이다. 쿠키는 **Key**와 **Value**로 이뤄진 일종의 단위로, 서버가 클라이언트에게 쿠키를 발급하면, 클라이언트는 서버에 요청을 보낼때마다 쿠키를 보냄으로써 서버는 클라이언트를 구분한다. 
* Connectionless
  하나의 요청에 하나의 응답을 한 후 연결을 종료하는 것을 의미한다. 특정 요청에 대한 연결은 이후의 요청과 이어지지 않고 새 요청이 있을 때 마다 항상 새로운 연결을 맺는다.
* Stateless
  통신이 끝난 후 상태 정보를 저장하지 않는 것을 의미한다. 이전 연결에서 사용한 데이터를 다른 연결에서 요구할 수 없다.
### Cookie의 용도
---
일반적으로 클라이언트의 정보 기록과 상태 정보를 표현하는 용도로 사용한다.
#### 정보 기록
웹 서버는 각 클라이언트의 팝업 옵션을 기록하고, 쿠키를 통해 팝업 표시 여부를 판단한다. 쿠키는 매번 전송되기 때문에 필요없는 경우에는 리소스 낭비가 발생할 수 있다. 최근에는 이러한 단점을 극복하기 위한 **Modern Storage APIs**를 통해 데이터를 저장하는 방식을 권장하고 있다.
#### 상태 정보
클라이언트의 로그인 상태와 이용자를 구별하는 데 사용한다.
### Cookie 변조
---
악의적인 클라이언트가 쿠키의 정보를 변조해서 서버에 요청을 보낼 때, 별다른 검증 없이 쿠키를 통해 인증 정보를 식별한다면 타 이용자의 개인정보가 유출 될 수 있다.
<br><br>

## Session
### Session이란?
---
쿠키가 인증 정보를 저장하지만 클라이언트가 인증 정보를 변조할 수 없게 하기 위해서 나온 것이 세션이다. 세션은 인증 정보를 서버에 저장하고 해당 데이터에 접근할 수 있는 **키(랜덤한 문자열)**를 만들어 클라이언트에 전달하는 방식을 이용한다. 해당 키를 **Session ID**라고 한다. 브라우저는 해당 키를 쿠키에 저장하고, 이후에 HTTP요청을 보낼 때 사용한다. 서버는 요청에 포함된 키에 해당하는 데이터를 가져와 인증 상태를 확인한다. 쿠키는 데이터 자체를 이용자가 저장하며, 세션은 서버가 저장한다. 
### Cookie 적용법
---
쿠키는 클라이언트에 저장되므로 클라이언트는 저장된 쿠키를 조회, 수정, 추가할 수 있다. 클라이언트는 요청을 보낼 때 저장된 쿠키를 요청 헤더에 넣어서 전송하기 때문에 쿠키 헤더를 변조할 수 있다. 쿠키를 설정할 때는 만료 시간을 지정할 수 있고, 만료시간 이후에는 클라이언트에서 쿠키가 삭제된다. 쿠키의 만료는 클라이언트(브라우저)에서 관리된다. 
* 서버
  HTTP 응답 중 헤더에 쿠키 설정 헤더 (Set-Cookie)를 추가하면 클라이언트의 브라우저가 쿠키를 설정한다.
  ```
  HTTP/1.1 200 OK
  Server: Apache/2.4.29 (Ubuntu)
  Set-Cookie: name=test;
  Set-Cookie: age=30; Expires=Fri, 30 Sep 2022 14:54:50 GMT;
  ...
  ```
* 클라이언트
  자바스크립트를 사용해 쿠키를 설정한다.
  ```
  document.cookie = "name=test;"
  document.cookie = "age=30; Expires=Fri, 30 Sep 2022 14:54:50 GMT;"
  ```
### Cookie 이용
* Chrome Console
  `console`에서 `document.cookie`를 입력하여 cookie를 확인 할 수 있다.
  쿠키 옵션에 따라 자바스크립트에서 쿠키 확인이 불가능 할 수 있다.
* Chrome Application
  `Application`에서 좌측에 `Cookies`를 펼치면 Origin 목록을 확인 할 수 있다. 
이를 이용해서 쿠키를 훔쳐서, 세션에 해당하는 이용자의 인증 상태를 훔친는 것을 **세션 하이재킹** (Session Hijacking)이라고 한다.