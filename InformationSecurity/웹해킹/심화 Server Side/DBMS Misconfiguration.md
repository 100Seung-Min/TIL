## DBMS Misconfiguration
### DBMS Misconfiguration
---
#### Out of DBMS
DBMS에서 제공하는 특별한 함수 또는 기능등을 이용해 파일 시스템, 네트워크, OS명령어에 접근 할 수 있다. 이러한 접근은 DBMS의 버전과 설정에 따라 동작하지 않을 수 있다. 
#### MySQL
파일 관련된 작업을 할 때는 `mysql`권한으로 수행되며, "my.cnf"설정 파일의 `secure_file_priv`값에 영향을 받는다. 쿼리 내에서 `load_file` 혹은 `outfile`을 이용해 파일에 접근할 때 접근할 수 있는 파일 경로에 대한 정보를 갖고 있는다.
- load_file
인자로 전달된 파일을 읽고 출력한다. 전달되는 파일은 전체 경로를 입력해야 하고, 해당 파일에 접근 권한이 있어야 한다.
- into outfile
`SELECT ... INTO`형식의 쿼리는 쿼리 결과를 변수나 파일에 쓸 수 있다. 만약 `secure_file_priv`의 값이 올바르지 않아 임의 경로에서 파일 작업을 수행 할 수 있다면 이를 통해 웹셸을 업로드하는 공격이 가능하다. 
#### MSSQL
`xp_cmdshell`기능을 이용해 OS 명령어를 실행할 수 있다. 과거에는 기본적으로 활성화되어 있었지만 현재는 대부분 비활성화되어있다. 
```sql
SELECT * FROM sys.configurations WHERE name = 'xp_cmdshell' # 활성화 되어 있는지 확인
EXEC xp_cmdshell "net user";
EXEC master.dbo.xp_cmdshell 'ping 127.0.0.1';
```
#### DBMS 권한 문제 주의 사항
- DBMS 애플리케이션 작동권한
리눅스 서버에서는 이용자 별로 권한을 나누어 관리한다. 이를 이용해 서버에서 DBMS를 작동할 때에는 DBMS 전용 계정 (nologin)을 만들어 사용해야 한다. 루트 계정이나 다른 애플리케이션 권한(www-data)이 탈취되면 큰 문제가 발생할 수 있다.
- DBMS 계정 권한
일반적으로 DBMS 내부에 계정과 권한이 존재한다. 웹 애플리케이션에서 DBMS의 루트 계정을 사용하고, 여러 서비스에서 같은 DBMS를 사용할 때 접속 계정을 분리하지 않는 경우가 있다. 이떄, 한 서비스에서 SQL Injection 취약점이 발생하면 서비스에서 사용하는 DBMS 계정으로 타 데이터베이스에 접근할 수 있다. 따라서 루트 계정의 사용을 지양하고, 서비스 및 기능 별로 계정을 생성해 사용해야 한다.
#### DBMS 문자열 비교 주의 사항
- 대소문자 구분
일부 DBMS에서는 비교 연산에서 대소문자를 구분하지 않는다.
- space로 끝나는 문자열 비교
공백을 추가하지 않은 문자와 추가한 문자가 서로 같다.
#### DBMS 다중 쿼리 주의 사항
대부분의 웹 애플리케이션은 다중 쿼리를 지원하지 않지만, 만약 지원한다면 새로운 쿼리를 작성해 데이터베이스를 삭제하거나 값을 추가하는 등의 행위가 가능하다.
- 다중 쿼리의 예시
**PHP Data Object**(PDO)를 사용해 다중 쿼리를 사용할 수 있다. `query`가 아닌 `exec`에서만 지원가능하다.